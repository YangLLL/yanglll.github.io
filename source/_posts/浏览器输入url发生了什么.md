---
title: 浏览器输入url发生了什么?
date: 2021-05-27 11:00:57
tags:
---

浏览器中输入一个 url 到页面展示的主要流程分为下面几个阶段：
1. 构建请求
2. 查找浏览器缓存
3. DNS 解析
4. 建立 TCP 连接
5. 发起 HTTP 请求
6. 响应请求
7. 断开连接
8. 页面渲染

### 1. 构建请求
解析url，构建请求行

### 2. 查找浏览器缓存
在请求之前会查找浏览器中是否有缓存，如果有缓存就用缓存的资源，如果没有再请求
缓存分为强缓存和协商缓存。
- 强缓存
看是否有 Cache-Contol，如果没有超过 Cache-Contol 的 max-age，则命中强缓存，返回缓存的资源。http 1.0 使用 Expires 来判断。如果超过了 max-age，再看是否命中了协商缓存
- 协商缓存

### 3. DNS 解析
DNS服务器中有一个域名IP对照表，可以返回域名对应的 IP

### 4. 建立 TCP 连接
客户端和服务器通过三次握手建立 TCP 连接。
首先 客服端向服务端发送一个消息，服务器接收到消息后，表示客户端发送消息的能力没问题，服务端接收能力没问题，然后服务端向客服端回了一个消息，表示客户端发送消息的能力也没问题，客户端接收到消息，表示客户端接收数据的能力也没问题。这样，客户端和服务端之间就可以传输数据了

### 5. 发起 HTTP 请求
客服端向服务端发送请求

### 6. 响应请求
服务器接收到请求后，进行处理，将对应的资源返回给客户端

- 响应状态码

### 7. 断开连接
数据发送完了之后，通过 “四次挥手” 断开连接。
首先是客服端往服务端发送一个消息，要断开连接了，然后服务端回复可以断开连接了，客户端发送断开连接的消息给服务端，并断开了客户端的连接，服务器收到之后也断开了服务端的连接

### 8. 页面渲染
浏览器获取到资源后，就要进行页面渲染。页面渲染分为以下几个阶段

- DOM解析
 将 html 解析成dom 树
- CSS 解析
然后解析CSS，生成 css规则树
- render
结合 DOM 树和 CSSOM 树，构建render树
- layout
然后进行布局
- paint
最后绘制到页面上
- 回流（reflow）、重绘（repaint）

- JavaScript编译执行


